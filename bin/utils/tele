#!/usr/bin/env bash
#
# Einfache Telegram-CLI:  tele "Nachricht"  â‡’ sendet an deine Chat-ID
# - speichert Config automatisch in  ~/AlphaOs-Vault/.config/tele.env
#

set -euo pipefail
CONF="$HOME/AlphaOs-Vault/.config/tele.env"

init_config() {
  printf "\nğŸŒ  Einmalige Einrichtung der Telegram-Daten â€¦\n"
  read -rp "BOT_TOKEN   = " BOT_TOKEN
  read -rp "CHAT_ID     = " CHAT_ID
  mkdir -p "$(dirname "$CONF")"
  printf 'BOT_TOKEN=%s\nCHAT_ID=%s\n' "$BOT_TOKEN" "$CHAT_ID" > "$CONF"
  chmod 600 "$CONF"
  echo "âœ…  Konfigurationsdatei erstellt â†’ $CONF"
}

[[ -f $CONF ]] || init_config
# shellcheck source=/dev/null
source "$CONF"

[[ $# -gt 0 ]] || { echo "Usage: tele \"Nachricht\""; exit 1; }
TEXT=$(printf "%s" "$*" | sed 's/"/\\"/g')

curl -sS \
  -X POST \
  "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
  -d "chat_id=${CHAT_ID}" \
  -d "text=${TEXT}" \
  -d "parse_mode=MarkdownV2" \
  >/dev/null && echo "ğŸ“¨  Nachricht gesendet."
